!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager"),a=tinymce.util.Tools.resolve("tinymce.Env"),n=function(e){return e.getParam("pagebreak_split_block",!1)},t=function(){return'<img src="'+a.transparentSrc+'" class="mce-pagebreak" data-mce-resize="false" data-mce-placeholder />'};e.add("pagebreak",(function(e){var a,r,o,c,i,g;(a=e).addCommand("mcePageBreak",(function(){n(a)?a.insertContent("<p>"+t()+"</p>"):a.insertContent(t())})),(r=e).ui.registry.addButton("pagebreak",{icon:"page-break",tooltip:"Page break",onAction:function(){return r.execCommand("mcePageBreak")}}),r.ui.registry.addMenuItem("pagebreak",{text:"Page break",icon:"page-break",onAction:function(){return r.execCommand("mcePageBreak")}}),c=(o=e).getParam("pagebreak_separator","\x3c!-- pagebreak --\x3e"),i=new RegExp(c.replace(/[\?\.\*\[\]\(\)\{\}\+\^\$\:]/g,(function(e){return"\\"+e})),"gi"),o.on("BeforeSetContent",(function(e){e.content=e.content.replace(i,t())})),o.on("PreInit",(function(){o.serializer.addNodeFilter("img",(function(e){for(var a,t,r=e.length;r--;)if((t=(a=e[r]).attr("class"))&&-1!==t.indexOf("mce-pagebreak")){var i=a.parent;if(o.schema.getBlockElements()[i.name]&&n(o)){i.type=3,i.value=c,i.raw=!0,a.remove();continue}a.type=3,a.value=c,a.raw=!0}}))})),(g=e).on("ResolveName",(function(e){"IMG"===e.target.nodeName&&g.dom.hasClass(e.target,"mce-pagebreak")&&(e.name="pagebreak")}))}))}();